<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Despesas</title>
</head>
<body>
    <a href="{% url 'home' %}" class="button">Página Inicial</a>
    <br>
    <br>
    <div class="filtro">
        <form method="get" action="{% url 'baixar_despesas_filtradas' %}">
            <div class="form-group">
                <label for="id_valor">Valor:</label>
                <input type="text" name="valor" class="form-control" id="id_valor" value="{{ valor_filtro }}">
            </div>
            <div class="form-group">
                <label for="id_data">Data:</label>
                <input type="date" name="data" class="form-control" id="id_data" value="{{ data_filtro }}">
            </div>
            <div class="form-group">
                <label for="id_categoria">Categoria:</label>
                <select name="categoria" class="form-control" id="id_categoria">
                    <option value="">--Selecione--</option>
                    {% for categoria in CATEGORIAS_DESPESA %}
                    <option value="{{ categoria.0 }}" {% if categoria.0 == categoria_filtro %} selected {% endif %}>{{ categoria.1 }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Filtrar</button>
            <a href="{% url 'baixar_despesas' %}" class="btn btn-secondary">Baixar tudo</a>
            <a href="{% url 'home' %}" class="btn btn-secondary">Voltar</a>
        </form>
    </div>

    <h2>Resumo de Despesas</h2>
    <table>
        <thead>
            <tr>
                <th>Categoria</th>
                <th>Total Gasto</th>
            </tr>
        </thead>
        <tbody>
            {% for categoria, total_gasto in resumo_despesas.items %}
            <tr>
                <td>{{ categoria }}</td>
                <td>R$ {{ total_gasto }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Lista de Despesas</h2>
    <a href="{% url 'baixar_despesas'%}">Baixar todas as despesas</a>

    <ul>
        {% for despesa in despesas %}
        <li> R$ -{{ despesa.valor }} -- {{ despesa.data }} --{{despesa.categoria}} -- {{ despesa.descricao }} -- {{ despesa.comprovante}} -- (criado em: {{ despesa.criado_em|date:"d/m/Y H:i:s"}})  <a href="{% url 'editar_despesa' despesa.id %}">editar</a></li><br>

        <form action="{% url 'deletar_despesa' despesa.id %}" method="POST" style="display: inline;">
            {% csrf_token %}
            <button type="submit">apagar</button>
            <br>
            <br>
        </form>
        {% empty %}
            <p>Não há despesas para exibir.</p>
        {% endfor %}
    </ul>

</body>
</html>    